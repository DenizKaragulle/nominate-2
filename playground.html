<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="assets/stylesheets/tailcoat.css">
	<link rel="stylesheet" type="text/css" href="assets/stylesheets/layout.css">
	<link rel="stylesheet" type="text/css" href="assets/stylesheets/editor.css">
	<link rel="stylesheet" type="text/css" href="assets/stylesheets/styles.css">
	<link rel="stylesheet" type="text/css" href="//js.arcgis.com/3.12/dijit/themes/nihilo/nihilo.css">
	<link rel="stylesheet" type="text/css" href="//js.arcgis.com/3.12/esri/css/esri.css">

	<style>
		.container {
			padding: 10px;
			color: #555;
			-webkit-font-smoothing: antialiased;
			font-size: 0.80em;
			font-family: 'Avenir LT W01 65 Medium', Arial, Helvetica, sans-serif;
		}

		#map {
			width: 100%;
			height: 100%;
		}

		#map-mask {
			opacity: 1.0;
			position: absolute;
			z-index: 100;
			margin-left: 350px;
			margin-top: 150px;
		}

		#meta-data-content {
			opacity: 0.0;
		}

		#map-draw-time-content {

		}

		#num-layers-content {
		}

		.num-layers {
			line-height: 1.3;
		}

	</style>

	<script type="text/javascript">
		var package_path = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/'));
		var dojoConfig = {
			async:true,
			// The locationPath logic below may look confusing but all its doing is
			// enabling us to load the api from a CDN and load local modules from the correct location.
			packages:[
				{
					name:"config",
					location:package_path + '/config'
				}
			]
		};
	</script>
	<script src="assets/javascripts/tailcoat.js"></script>
	<script src="//js.arcgis.com/3.12/"></script>

	<script>

		require([
			"dojo/_base/fx",
			"dijit/Tooltip",
			"put-selector/put",
			"dojo/store/Memory",
			"dgrid/extensions/Pagination",
			"dgrid/OnDemandGrid",
			"dgrid/OnDemandList",
			"dgrid/Keyboard",
			"dgrid/Selection",
			"dijit/Editor",
			"dijit/form/Button",
			"dijit/form/CheckBox",
			"dijit/form/ComboBox",
			"dijit/form/SimpleTextarea",
			"dijit/Dialog",
			"dijit/ProgressBar",
			"dojo/_base/array",
			"dojo/_base/declare",
			"dojo/_base/fx",
			"dojo/_base/lang",
			"dojo/aspect",
			"dojo/date",
			"dojo/Deferred",
			"dojo/dom",
			"dojo/dom-attr",
			"dojo/dom-class",
			"dojo/dom-construct",
			"dojo/dom-style",
			"dojo/html",
			"dojo/number",
			"dojo/on",
			"dojo/query",
			"esri/arcgis/Portal",
			"esri/arcgis/OAuthInfo",
			"esri/IdentityManager",
			"esri/arcgis/utils",
			"esri/config",
			"esri/map",
			"esri/request",
			"dojo/parser",
			"dojo/ready",
			"config/defaults",
			"config/details",
			"dojo/NodeList-traverse"
		], function (fx, Tooltip, put, Memory, Pagination, OnDemandGrid, OnDemandList, Keyboard, Selection, Editor, Button, CheckBox, ComboBox, SimpleTextarea, Dialog, ProgressBar, array, declare, fx, lang, aspect, date, Deferred, dom, domAttr, domClass, domConstruct, domStyle, html, number, on, query, arcgisPortal, ArcGISOAuthInfo, esriId, arcgisUtils, config, Map, esriRequest, parser, ready, defaults, details) {

			parser.parse();

			ready(function () {

				var map;
				var layers;
				var mapDrawComplete;

				run();

				function run() {
					var mapDrawBegin = performance.now();
					arcgisUtils.createMap("b95a9fb4dec5443f9e0ea0fcb4859c67", "map").then(function (response) {
						layers = response.itemInfo.itemData.operationalLayers;
						console.log(layers);
						map = response.map;

						// make sure map is loaded
						if (map.loaded) {
							mapDrawComplete = performance.now();
							var mapDrawTime = (mapDrawComplete - mapDrawBegin);
							query(".map-draw-time")[0].innerHTML = processMapDrawTime(mapDrawTime);
							fadeLoader();
							array.forEach(layers, processLayers);
							fadeInContent();
						}
					});
				}

				function fadeInContent() {
					var loaderNode = dom.byId("meta-data-content");
					fx.animateProperty({
						node: loaderNode,
						properties: {
							opacity: {
								start: 0,
								end: 1
							}
						},
						duration: 500
					}).play();
				}

				function fadeLoader() {
					var loaderNode = dom.byId("map-mask");
					domStyle.set(loaderNode, "opacity", "1");
					var fadeArgs = {
						node: "map-mask",
						duration: 2000
					};
					fx.fadeOut(fadeArgs).play();
				}

				function processLayers(layer) {
					domConstruct.create("div", {
						innerHTML:"<div>" + layer.title + "<\/div>"
					}, query(".num-layers")[0], "last");
				}

				function processMapDrawTime(val) {
					var temp = (val / 1000) % 60;
					var seconds = number.format(temp, {
						places:5
					});
					if (seconds) {
						return seconds + " seconds";
					} else {
						return "N/A";
					}
				}
			});
		});

	</script>
</head>

<body class="nihilo">


<div class="container">
	<div class="row">
		<!-- Map -->
		<div class="column-15">
			<div id="map-mask" class="loader">
				<span class="side side-left"><span class="fill"></span></span>
				<span class="side side-right"><span class="fill"></span></span>
				<p class="loading-word">Loading...</p>
			</div>
			<div id="map"></div>
		</div>

		<!-- Map metadata -->
		<div id="meta-data-content" class="column-9">
			<!-- Map draw time -->
			<div class="row">
				<div id="map-draw-time-content" class="column-24">
					<div class="section-header">MAP DRAW TIME</div>
					<div class="map-draw-time"></div>
				</div>
			</div>

			<!-- Number of map layers -->
			<div class="row">
				<div id="num-layers-content" class="column-24">
					<div class="section-header">LAYERS</div>
					<div class="num-layers"></div>
				</div>
			</div>

			<!-- Popups -->
			<div class="row">
				<div class="column-24">
					<div class="pop-ups"></div>
				</div>
			</div>
		</div>
	</div>
</div>

</body>
</html>